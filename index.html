<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoanLink - Smart Loan Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- Ionicons for Icons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>

<body>
    <div id="app-root">
        <!-- Auth View is inserted here directly if not logged in -->
    </div>

    <!-- Templates -->

    <!-- 1. Auth View -->
    <template id="view-auth">
        <div class="auth-wrapper">
            <section class="glass-panel" style="width: 100%; max-width: 400px; padding: 40px;">
                <div class="text-center" style="margin-bottom: 30px;">
                    <div class="brand-icon" style="margin: 0 auto 20px auto;">LL</div>
                    <h2 id="auth-title">Welcome Back</h2>
                    <p style="color: var(--text-secondary);">Manage your loans with clarity.</p>
                </div>

                <form id="auth-form">
                    <div class="form-group" id="name-group" style="display: none;">
                        <input type="text" id="auth-name" class="form-input" placeholder="Full Name">
                    </div>
                    <div class="form-group">
                        <input type="email" id="auth-email" class="form-input" placeholder="Email Address" required>
                    </div>
                    <div class="form-group">
                        <input type="password" id="auth-password" class="form-input" placeholder="Password" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="auth-submit">Login</button>
                </form>

                <div class="text-center mt-4">
                    <span id="auth-switch-text" style="color: var(--text-secondary);">Don't have an account?</span>
                    <a href="#" id="auth-switch-btn"
                        style="color: #818cf8; font-weight: 600; text-decoration: none; margin-left: 5px;">Sign Up</a>
                </div>
                <div class="text-center mt-2" id="forgot-password-container">
                    <a href="#" id="forgot-password-btn"
                        style="color: var(--text-secondary); font-size: 0.8em; text-decoration: none;">Forgot
                        Password?</a>
                </div>
            </section>
        </div>
    </template>

    <!-- 1b. Reset Password View -->
    <template id="view-reset-password">
        <div class="auth-wrapper">
            <section class="glass-panel" style="width: 100%; max-width: 400px; padding: 40px;">
                <div class="text-center" style="margin-bottom: 30px;">
                    <h2>Set New Password</h2>
                    <p style="color: var(--text-secondary);">Enter your new password below.</p>
                </div>
                <form id="reset-password-form">
                    <div class="form-group">
                        <input type="password" id="reset-new-password" class="form-input" placeholder="New Password"
                            required minlength="6">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Update Password</button>
                    <button type="button" class="btn btn-secondary mt-2" style="width: 100%;"
                        onclick="navigate('auth')">Back to Login</button>
                </form>
            </section>
        </div>
    </template>

    <!-- 2. Main App Layout (Shell) -->
    <template id="layout-app">
        <div class="app-layout">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div>
                    <div class="brand">
                        <div class="brand-icon">LL</div>
                        <h1>LoanLink</h1>
                    </div>

                    <nav class="nav-links">
                        <a class="nav-item active" id="nav-dashboard">
                            <ion-icon name="grid-outline"></ion-icon>
                            <span>Overview</span>
                        </a>
                        <a class="nav-item" id="nav-create">
                            <ion-icon name="add-circle-outline"></ion-icon>
                            <span>New Agreement</span>
                        </a>
                        <a class="nav-item" id="nav-marketplace">
                            <ion-icon name="shop-outline"></ion-icon>
                            <span>Marketplace</span>
                        </a>
                        <a class="nav-item" id="nav-archive">
                            <ion-icon name="archive-outline"></ion-icon>
                            <span>Archive</span>
                        </a>
                        <a class="nav-item" id="nav-profile">
                            <ion-icon name="person-outline"></ion-icon>
                            <span>Profile</span>
                        </a>
                    </nav>
                </div>

                <div>
                    <div class="user-profile" id="user-profile-display">
                        <div class="user-avatar"></div>
                        <div class="user-info">
                            <div id="sidebar-username">User</div>
                            <div id="sidebar-email">email@example.com</div>
                        </div>
                    </div>
                    <a class="nav-item" id="nav-logout" style="margin-top: 10px; color: var(--danger);">
                        <ion-icon name="log-out-outline"></ion-icon>
                        <span>Logout</span>
                    </a>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="main-content" id="main-content-area">
                <!-- Views injected here -->
            </main>
        </div>
    </template>

    <!-- 3. Dashboard View -->
    <template id="view-dashboard">
        <div class="page-header">
            <h2 class="page-title" id="welcome-header">Dashboard</h2>
            <p class="page-subtitle">Here's what's happening with your loans.</p>
        </div>

        <section class="dashboard-grid">
            <div class="glass-panel stat-card">
                <h3>Total I Owe</h3>
                <div class="stat-value negative" id="total-owed">$0.00</div>
            </div>
            <div class="glass-panel stat-card">
                <h3>Total Owed to Me</h3>
                <div class="stat-value positive" id="total-lent">$0.00</div>
            </div>
        </section>

        <!-- Pending Section -->
        <section id="pending-section" class="hidden">
            <div class="section-header">
                <h3 class="section-title">Pending Requests <span
                        style="background: var(--warning); color: black; font-size: 0.7em; padding: 2px 8px; border-radius: 10px; margin-left: 8px;">Action
                        Required</span></h3>
            </div>
            <div class="loan-list" id="pending-container">
                <!-- Items -->
            </div>
        </section>

        <!-- Active Section -->
        <div class="section-header">
            <h3 class="section-title">Active Loans</h3>
            <!-- Filter or View All link -->
        </div>
        <div class="loan-list" id="active-container">
            <!-- Items -->
            <div class="glass-panel text-center" style="opacity: 0.6; padding: 40px;">
                <p>No active loans. Start by creating a new agreement.</p>
            </div>
        </div>
        <!-- Completed section moved to Archive view -->
    </template>

    <!-- Archive View -->
    <template id="view-archive">
        <div class="page-header">
            <h2 class="page-title">Archive</h2>
            <p class="page-subtitle">History of completed and settled loans.</p>
        </div>

        <div class="loan-list" id="archive-container">
            <!-- Items -->
            <div class="glass-panel text-center" style="opacity: 0.6; padding: 40px;">
                <p>No archived loans found.</p>
            </div>
        </div>
    </template>

    <!-- Marketplace View -->
    <template id="view-marketplace">
        <div class="page-header"
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <div>
                <h2 class="page-title">Marketplace</h2>
                <p class="page-subtitle">Find items to borrow or lend your own.</p>
            </div>
            <button class="btn btn-primary" id="btn-open-listing">+ Post Listing</button>
        </div>

        <div id="listings-container" class="dashboard-grid"
            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 24px;">
            <!-- Items filled dynamically -->
        </div>
    </template>


    <!-- 4. Create View -->
    <template id="view-create">
        <div class="page-header">
            <h2 class="page-title">New Agreement</h2>
            <p class="page-subtitle">Draft a new loan proposal to send to another party.</p>
        </div>

        <div class="glass-panel" style="max-width: 700px;">
            <form id="create-loan-form">
                <div class="form-group" style="margin-bottom: 24px;">
                    <label style="display: block; margin-bottom: 12px; color: var(--text-secondary);">Your Role</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <label class="btn btn-secondary" style="text-align: center; font-size: 0.9em; padding: 10px;">
                            <input type="radio" name="role" value="borrower" checked style="display:none;">
                            I am Borrowing
                        </label>
                        <label class="btn btn-secondary" style="text-align: center; font-size: 0.9em; padding: 10px;">
                            <input type="radio" name="role" value="lender" style="display:none;">
                            I am Lending
                        </label>
                    </div>
                    <div style="display: none;">
                        <label class="btn btn-secondary" id="type-currency-label">
                            <input type="radio" name="assetType" value="currency" checked>
                            Money
                        </label>
                        <label class="btn btn-secondary" id="type-item-label">
                            <input type="radio" name="assetType" value="item">
                            Physical Item
                        </label>
                    </div>
                </div>

                <!-- Item Specific Fields (Hidden by default) -->
                <div id="item-fields" class="hidden" style="margin-bottom: 24px;">
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Item
                            Name</label>
                        <input type="text" id="item-name" class="form-input" placeholder="e.g. PS5, Tesla Model 3">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label
                                style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Condition</label>
                            <input type="text" id="item-condition" class="form-input"
                                placeholder="e.g. New, Used - Excellent">
                        </div>
                        <div class="form-group">
                            <label
                                style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Description</label>
                            <input type="text" id="item-description" class="form-input"
                                placeholder="e.g. Serial #12345, include cables">
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label id="counterparty-label"
                            style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Counterparty
                            Email</label>
                        <input type="email" id="counterparty-email" class="form-input" placeholder="friend@example.com"
                            required>
                    </div>
                    <div class="form-group">
                        <label id="amount-label"
                            style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Amount ($)</label>
                        <input type="number" id="amount" class="form-input" placeholder="1000" min="0" step="0.01"
                            required>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Interest Rate
                            (%)</label>
                        <input type="number" id="interest" class="form-input" value="0" min="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Type</label>
                        <select id="interest-type" class="form-input">
                            <option value="simple">Simple</option>
                            <option value="compound">Compound</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Months</label>
                        <input type="number" id="tenure" class="form-input" value="12" min="1" max="60">
                    </div>
                </div>

                <div id="payment-preview"
                    style="background: rgba(99, 102, 241, 0.1); padding: 20px; border-radius: var(--radius-md); margin: 20px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span id="preview-monthly-label">Monthly Payment:</span>
                        <span id="preview-monthly" style="font-weight: 700; color: var(--success);">$0.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span id="preview-total-label">Total Repayment:</span>
                        <span id="preview-total" style="font-weight: 700; color: var(--success);">$0.00</span>
                    </div>
                </div>

                <div class="form-group">
                    <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Alias Name</label>
                    <input type="text" id="counterparty" class="form-input" placeholder="e.g. John (for your reference)"
                        required>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px;">
                    <button type="button" id="create-cancel" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Send Proposal</button>
                </div>
            </form>
        </div>
    </template>

    <!-- 5. Profile View -->
    <template id="view-profile">
        <div class="page-header">
            <h2 class="page-title">Your Profile</h2>
            <p class="page-subtitle">Manage your personal information.</p>
        </div>

        <div class="glass-panel" style="max-width: 600px;">
            <form id="profile-form">
                <div class="form-group">
                    <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Full
                        Name</label>
                    <input type="text" id="profile-name" class="form-input" placeholder="Your Name" required>
                </div>
                <div class="form-group">
                    <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Alias /
                        Nickname</label>
                    <input type="text" id="profile-alias" class="form-input"
                        placeholder="Calculates to 'Alias Name' in loans">
                    <p style="font-size:0.8em; color:var(--text-secondary); margin-top:4px;">This name will be
                        visible to others if you provide it.</p>
                </div>
                <div class="form-group">
                    <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Contact
                        Number</label>
                    <input type="text" id="profile-contact" class="form-input" placeholder="+1 234 567 890">
                </div>
                <div class="form-group">
                    <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Date of
                        Birth</label>
                    <input type="date" id="profile-dob" class="form-input">
                </div>
                <div class="form-group">
                    <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Email</label>
                    <input type="email" id="profile-email" class="form-input" disabled style="opacity: 0.5;">
                </div>

                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>

            <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 30px 0;">

            <form id="change-password-form">
                <h3 style="margin-bottom: 20px; color: var(--text-primary);">Security</h3>
                <div class="form-group">
                    <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Current
                        Password</label>
                    <input type="password" id="current-password" class="form-input" placeholder="••••••••" required>
                </div>
                <div class="form-group">
                    <label style="color: var(--text-secondary); display: block; margin-bottom: 8px;">New
                        Password</label>
                    <input type="password" id="new-password" class="form-input" placeholder="••••••••" required
                        minlength="6">
                </div>
                <button type="submit" class="btn btn-secondary" style="width: 100%;">Change Password</button>
            </form>
        </div>
    </template>

    <!-- Modals -->

    <!-- Pending Loan Review Modal -->
    <div id="review-modal" class="modal hidden"
        style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 100;">
        <div class="glass-panel" style="width: 90%; max-width: 500px; background: #1e293b;">
            <h3 style="margin-bottom: 20px;">Review Loan Proposal</h3>
            <div id="review-content" style="margin-bottom: 24px; line-height: 1.6;">
                <!-- Filled dynamically -->
            </div>

            <div
                style="background: rgba(255,255,255,0.05); padding: 16px; border-radius: 8px; margin-bottom: 24px; font-size: 0.9em;">
                <p><strong>Terms & Conditions:</strong></p>
                <p>By accepting this loan, you agree to the repayment schedule outlined above. Both parties
                    acknowledge
                    this is a digital record of a mutual agreement.</p>
            </div>

            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                <button id="reject-btn" class="btn btn-danger">Reject</button>
                <button id="accept-btn" class="btn btn-primary">Accept & Activate</button>
            </div>
            <button id="close-review"
                style="position: absolute; top: 16px; right: 16px; background: none; border: none; color: white; cursor: pointer; font-size: 1.5rem;">&times;</button>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="payment-modal" class="modal hidden"
        style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 100;">
        <div class="glass-panel" style="width: 90%; max-width: 400px; background: #1e293b;">
            <h3 style="margin-bottom: 20px;">Record Payment</h3>
            <div class="form-group" style="margin-bottom: 12px;">
                <label
                    style="color: var(--text-secondary); display: block; margin-bottom: 8px; font-size: 0.9em;">Amount
                    ($)</label>
                <input type="number" id="payment-amount" class="form-input" placeholder="0.00" step="0.01">
            </div>

            <div class="form-group" style="margin-bottom: 12px;">
                <label
                    style="color: var(--text-secondary); display: block; margin-bottom: 8px; font-size: 0.9em;">Payment
                    Method</label>
                <select id="payment-method" class="form-input">
                    <option value="Cash">Cash</option>
                    <option value="Direct Transfer">Direct Transfer</option>
                    <option value="Cheque">Cheque</option>
                    <option value="Other">Other...</option>
                </select>
                <input type="text" id="payment-method-other" class="form-input hidden" placeholder="Specify method"
                    style="margin-top: 8px;">
            </div>

            <div class="form-group">
                <label
                    style="color: var(--text-secondary); display: block; margin-bottom: 8px; font-size: 0.9em;">Date</label>
                <input type="date" id="payment-date" class="form-input">
            </div>
            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                <button id="cancel-payment" class="btn btn-secondary">Cancel</button>
                <button id="confirm-payment" class="btn btn-primary">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Loan Details Modal -->
    <div id="details-modal" class="modal hidden"
        style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 100;">
        <div class="glass-panel"
            style="width: 95%; max-width: 800px; max-height: 90vh; background: #1e293b; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 id="details-title" style="margin: 0;">Loan Details</h3>
                <button id="close-details"
                    style="background: none; border: none; color: white; cursor: pointer; font-size: 1.5rem;">&times;</button>
            </div>

            <div class="dashboard-grid" style="margin-bottom: 24px;">
                <div class="glass-panel stat-card" style="padding: 16px;">
                    <h4 style="font-size: 0.9em; color: var(--text-secondary);">Total Repayment</h4>
                    <div class="stat-value" id="details-total" style="font-size: 1.5em;">$0.00</div>
                </div>
                <div class="glass-panel stat-card" style="padding: 16px;">
                    <h4 style="font-size: 0.9em; color: var(--text-secondary);">Paid So Far</h4>
                    <div class="stat-value text-accent" id="details-paid" style="font-size: 1.5em;">$0.00</div>
                </div>
                <div class="glass-panel stat-card" style="padding: 16px;">
                    <h4 style="font-size: 0.9em; color: var(--text-secondary);">Remaining</h4>
                    <div class="stat-value" id="details-remaining" style="font-size: 1.5em;">$0.00</div>
                </div>
            </div>

            <!-- Chart Section -->
            <div style="background: rgba(0,0,0,0.2); border-radius: 12px; padding: 16px; margin-bottom: 24px;">
                <canvas id="details-chart" height="200"></canvas>
            </div>

            <!-- History List -->
            <h4 style="margin-bottom: 12px;">Payment History</h4>
            <div id="details-history-list" style="display: flex; flex-direction: column; gap: 8px;">
                <!-- Items -->
            </div>
        </div>
    </div>

    <!-- Listing Modal -->
    <div id="listing-modal" class="modal hidden"
        style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 100;">
        <div class="glass-panel" style="width: 95%; max-width: 500px; background: #1e293b;">
            <h3 style="margin-bottom: 20px;">Post New Listing</h3>
            <form id="listing-form">
                <div class="form-group">
                    <label style="color: var(--text-secondary);">Item Name</label>
                    <input type="text" id="listing-name" class="form-input" placeholder="e.g. PS5, Tesla" required>
                </div>
                <div class="form-group">
                    <label style="color: var(--text-secondary);">Description</label>
                    <textarea id="listing-desc" class="form-input" style="height: 80px;"
                        placeholder="Details about the item..."></textarea>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label style="color: var(--text-secondary);">Rental Fee ($)</label>
                        <input type="number" id="listing-charge" class="form-input" placeholder="50" step="0.01">
                    </div>
                    <div class="form-group">
                        <label style="color: var(--text-secondary);">Deposit ($)</label>
                        <input type="number" id="listing-deposit" class="form-input" placeholder="100" step="0.01">
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label style="color: var(--text-secondary);">Location</label>
                        <input type="text" id="listing-location" class="form-input" placeholder="City, Area">
                    </div>
                    <div class="form-group">
                        <label style="color: var(--text-secondary);">Term (Months)</label>
                        <input type="number" id="listing-tenure" class="form-input" placeholder="1">
                    </div>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 10px;">
                    <button type="button" id="cancel-listing" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Post Now</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="app.js"></script>
</body>

</html>